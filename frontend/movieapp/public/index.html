<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Selector</title>
    <style>
    body {
        font-family: Arial, sans-serif;
    }
    .movie-list {
        display: flex;
        flex-wrap: wrap;
    }
    .movie-item {
        margin: 10px;
        cursor: pointer;
        padding: 10px;
        border: 1px solid #df7474;
        border-radius: 8px;
        background-color: #f1f1f1;
        width: 200px;
    }
    .movie-item.selected {
        background-color: #ddd;
    }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="movie-list"></div>
    <h1>Choose Your Favorite Films</h1>
    <div class="movie-list" id="movie-list"></div>
    <button id="showRelatedMovies" style="display: none;">Show Related Movies</button>
    <div class="related-movies" id="related-movies"></div>
    <div class="related-movies-container">
        <h2>Related Movies</h2>
        <ul class="related-movie-list" id="related-movies-list"></ul>
    </div>
</body>

<script>
  async function loadFilms() {
    try {
        const response = await fetch('http://localhost:5000/films'); 
        if (!response.ok) {
            throw new Error('Failed to fetch films');
        }
        const films = await response.json();
        console.log(films); 

        const movieListElement = document.getElementById('movie-list');
        if (!movieListElement) {
            throw new Error('Movie list container not found');
        }
        movieListElement.innerHTML = ''; 

        films.forEach(film => {
            const movieElement = document.createElement('div');
            movieElement.classList.add('movie-item');
            movieElement.textContent = film.title;
            movieElement.dataset.id = film.id;
            movieElement.addEventListener('click', () => {
                movieElement.classList.toggle('selected');
                toggleShowButton();  
            });

            movieListElement.appendChild(movieElement);
        });
    } catch (error) {
        console.error('Error loading films:', error);  
    }
}

document.addEventListener('DOMContentLoaded', loadFilms);
       
function toggleShowButton() {
    const selectedMovies = document.querySelectorAll('.movie-item.selected');
    const showButton = document.getElementById('showRelatedMovies');
    showButton.style.display = selectedMovies.length > 0 ? 'inline' : 'none';
}

async function loadRelatedMovies() {
    const selectedMovies = document.querySelectorAll('.movie-item.selected');
    const selectedIds = Array.from(selectedMovies).map(movie => movie.dataset.id);

    if (selectedIds.length === 0) {
        console.log('No films selected');
        return;
    }

    console.log('Selected Movie IDs:', selectedIds);

    try {
        const response = await fetch(`http://localhost:5000/related-movies?ids=${selectedIds.join(',')}`);
        const relatedMovies = await response.json();

        console.log('Related Movies:', relatedMovies); 
        displayRelatedMovies(relatedMovies);  // Now this function is being called
    } catch (error) {
        console.error('Error fetching related movies:', error);
    }
}

// Function to display related movies in the UI
function displayRelatedMovies(movies) {
    const relatedMoviesElement = document.getElementById('related-movies-list');
    relatedMoviesElement.innerHTML = '';  

    if (movies.length === 0) {
        relatedMoviesElement.innerHTML = '<p>No related movies found.</p>';
    } else {
        movies.forEach(movie => {
            const movieElement = document.createElement('li');
            movieElement.textContent = movie.title;
            relatedMoviesElement.appendChild(movieElement);
        });
    }
}

document.getElementById('showRelatedMovies').addEventListener('click', loadRelatedMovies);
</script>

</html>
